trigger:
  branches:
    include:
    - master
    - release/*

pr:
  branches:
    include:
    - main
    - release/*
    
jobs:
- job: Verify_Code_Style
  variables:
    DOTNET_NOLOGO: true
    DOTNET_SKIP_FIRST_TIME_EXPERIENCE: true
    DOTNET_CLI_TELEMETRY_OPTOUT: 1
  pool:
    vmImage: windows-latest
  steps:
  - checkout: self
    persistCredentials: true
  - task: PowerShell@2
    displayName: HelloWorld
    inputs:
      targetType: 'inline'
      script: |
        if (-not $env:SYSTEM_PULLREQUEST_TARGETBRANCH) {
          Write-Output "Running from branch"
        }
        else {
          Write-Output "Running from PR"
        }
  - task: PowerShell@2
    displayName: Verify code style
    inputs:
      targetType: 'inline'
      script: |
        dotnet regitlint -s src/Steeltoe.All.sln --print-command --skip-tool-check --jb-profile="Steeltoe Full Cleanup" --jb --properties:Configuration=Release --jb --verbosity=WARN --fail-on-diff --print-diff
